{"ast":null,"code":"import _toConsumableArray from\"/home/praime/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/praime/react-mesto-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Route,Routes,useNavigate}from\"react-router-dom\";import Footer from\"./Footer.js\";import Main from\"./Main.js\";import Header from\"./Header.js\";// import PopupWithForm from \"./PopupWithForm.js\";\nimport ImagePopup from\"./ImagePopup.js\";import{api}from\"../utils/Api.js\";import EditProfilePopup from\"./EditProfilePopup.js\";import EditAvatarPopup from\"./EditAvatarPopup.js\";import AddPlacePopup from\"./AddPlacePopup.js\";import ProtectedRoute from\"./ProtectedRoute\";import CurrentUserContext from\"../contexts/CurrentUserContext.js\";import InfoToolTip from\"./InfoTooltip.js\";import auth from\"../utils/MestoAuth.js\";import Register from\"./Register.js\";import Login from\"./Login.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),selectedCard=_useState2[0],setSelectedCard=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),cards=_useState4[0],setCards=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),currentUser=_useState6[0],setCurrentUser=_useState6[1];var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),userEmail=_React$useState2[0],setUserEmail=_React$useState2[1];var navigate=useNavigate();var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),linkName=_React$useState4[0],setLinkName=_React$useState4[1];var _React$useState5=React.useState(\"\"),_React$useState6=_slicedToArray(_React$useState5,2),linkRoute=_React$useState6[0],setLinkRoute=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isRegistrationSuccsses=_React$useState8[0],setIsRegistrationSuccsses=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),loggedIn=_React$useState10[0],setLoggedIn=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isEditProfilePopupOpen=_React$useState12[0],setIsEditProfilePopupOpen=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isAddPlacePopupOpen=_React$useState14[0],setIsAddPlacePopupOpen=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isEditAvatarPopupOpen=_React$useState16[0],setIsEditAvatarPopupOpen=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isRegistationResultPopupOpen=_React$useState18[0],setIsRegistationResultPopupOpen=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),isLoading=_React$useState20[0],setIsLoading=_React$useState20[1];function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}var handleCardClick=function handleCardClick(card){setSelectedCard(card);};function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsRegistationResultPopupOpen(false);setSelectedCard({});}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.error(err);});}function handleDeleteClick(card){api.deleteCard(card._id).then(function(){setCards(cards.filter(function(i){return i._id!==card._id;}));}).catch(function(err){console.error(err);});}var handleUpdateUser=function handleUpdateUser(_ref){var name=_ref.name,about=_ref.about;setIsLoading(true);api.patchUserInfo(name,about).then(function(newUser){setCurrentUser(newUser);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};var handleUpdateAvatar=function handleUpdateAvatar(data){setIsLoading(true);api.patchNewAvatar(data).then(function(newUser){setCurrentUser(newUser);closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};var handleAddPlaceSubmit=function handleAddPlaceSubmit(_ref2){var name=_ref2.name,link=_ref2.link;setIsLoading(true);api.postNewCard(name,link).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.error(err);}).finally(function(){setIsLoading(false);});};function swapHeaderLinks(name,route){setLinkName(name);setLinkRoute(route);}function handleSetUserEmail(email){setUserEmail(email);}/** Проверяет наличие токена */function checkToken(){if(localStorage.getItem(\"jwt\")){var jwt=localStorage.getItem(\"jwt\");auth.checkToken(jwt).then(function(data){setLoggedIn(true);handleSetUserEmail(data.data.email);navigate(\"/\");}).catch(function(err){console.error(err);});}}React.useEffect(function(){checkToken();},[]);function handleSignOutClick(){navigate(\"/sign-in\");localStorage.removeItem(\"jwt\");setLoggedIn(false);}function handleRegistration(isSuccsses){setIsRegistrationSuccsses(isSuccsses);setIsRegistationResultPopupOpen(true);}/** регистрация пользователя */function handleUserRegister(password,email){auth.register(password,email).then(function(data){navigate(\"/sign-in\");handleRegistration(true);}).catch(function(err){console.error(err);handleRegistration(false);});}/** авторизация пользователя */function handleUserAuthorization(password,email){auth.authorization(password,email).then(function(data){setLoggedIn(true);setUserEmail(email);navigate(\"/\");localStorage.setItem(\"jwt\",data.token);}).catch(function(err){console.error(err);});}React.useEffect(function(){if(loggedIn){api.getInitialCards().then(function(cardsList){setCards(cardsList);}).catch(function(err){console.error(err);});}},[loggedIn]);React.useEffect(function(){if(loggedIn){api.getUserInfo().then(function(data){setCurrentUser(data);}).catch(function(err){console.error(err);});}},[loggedIn]);return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{linkName:linkName,linkRoute:linkRoute,signOut:handleSignOutClick,isLoggedIn:loggedIn,userEmail:userEmail}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsx(Register,{onPage:swapHeaderLinks,onSubmit:handleUserRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsx(Login,{onPage:swapHeaderLinks,onSubmit:handleUserAuthorization,setUserEmail:setUserEmail})}),/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(ProtectedRoute,{loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleDeleteClick,onPage:swapHeaderLinks,isLoading:isLoading})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onUpdateUser:handleUpdateUser,onClose:closeAllPopups,isLoading:isLoading}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onAddPlace:handleAddPlaceSubmit,onClose:closeAllPopups,isLoading:isLoading}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,isLoading:isLoading}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isRegistationResultPopupOpen,name:\"info-tool-tip\",onClose:closeAllPopups,onUpdateAvatar:handleRegistration,isRegistrationSuccsses:isRegistrationSuccsses})]})});}export default App;","map":{"version":3,"sources":["/home/praime/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useState","Route","Routes","useNavigate","Footer","Main","Header","ImagePopup","api","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ProtectedRoute","CurrentUserContext","InfoToolTip","auth","Register","Login","App","selectedCard","setSelectedCard","cards","setCards","currentUser","setCurrentUser","userEmail","setUserEmail","navigate","linkName","setLinkName","linkRoute","setLinkRoute","isRegistrationSuccsses","setIsRegistrationSuccsses","loggedIn","setLoggedIn","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isRegistationResultPopupOpen","setIsRegistationResultPopupOpen","isLoading","setIsLoading","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","closeAllPopups","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","then","newCard","state","map","c","catch","err","console","error","handleDeleteClick","deleteCard","filter","handleUpdateUser","name","about","patchUserInfo","newUser","finally","handleUpdateAvatar","data","patchNewAvatar","handleAddPlaceSubmit","link","postNewCard","swapHeaderLinks","route","handleSetUserEmail","email","checkToken","localStorage","getItem","jwt","useEffect","handleSignOutClick","removeItem","handleRegistration","isSuccsses","handleUserRegister","password","register","handleUserAuthorization","authorization","setItem","token","getInitialCards","cardsList","getUserInfo"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { Route, Routes, useNavigate } from \"react-router-dom\";\nimport Footer from \"./Footer.js\";\nimport Main from \"./Main.js\";\nimport Header from \"./Header.js\";\n// import PopupWithForm from \"./PopupWithForm.js\";\nimport ImagePopup from \"./ImagePopup.js\";\nimport { api } from \"../utils/Api.js\";\nimport EditProfilePopup from \"./EditProfilePopup.js\";\nimport EditAvatarPopup from \"./EditAvatarPopup.js\";\nimport AddPlacePopup from \"./AddPlacePopup.js\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport CurrentUserContext from \"../contexts/CurrentUserContext.js\";\nimport InfoToolTip from \"./InfoTooltip.js\";\nimport auth from \"../utils/MestoAuth.js\";\nimport Register from \"./Register.js\";\nimport Login from \"./Login.js\";\n\nfunction App() {\n  const [selectedCard, setSelectedCard] = useState({});\n  const [cards, setCards] = useState([]);\n  const [currentUser, setCurrentUser] = useState({});\n  const [userEmail, setUserEmail] = React.useState(\"\");\n  const navigate = useNavigate();\n  const [linkName, setLinkName] = React.useState(\"\");\n  const [linkRoute, setLinkRoute] = React.useState(\"\");\n  const [isRegistrationSuccsses, setIsRegistrationSuccsses] = React.useState(false);\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isRegistationResultPopupOpen, setIsRegistationResultPopupOpen] = React.useState(false);\n  const [isLoading, setIsLoading] = React.useState(false);\n\n  \n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  const handleCardClick = (card) => {\n    setSelectedCard(card);\n  };\n\n\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsRegistationResultPopupOpen(false);\n    setSelectedCard({});\n  }\n\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    api\n      .changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setCards((state) =>\n          state.map((c) => (c._id === card._id ? newCard : c))\n        );\n      })\n      .catch((err) => {\n        console.error(err);\n      });\n  }\n\n  function handleDeleteClick(card) {\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        setCards(cards.filter((i) => i._id !== card._id));\n      })\n      .catch((err) => {\n        console.error(err);\n      });\n  }\n\n  const handleUpdateUser = ({ name, about }) => {\n    setIsLoading(true);\n    api\n      .patchUserInfo(name, about)\n      .then((newUser) => {\n        setCurrentUser(newUser);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.error(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      });\n  };\n\n  const handleUpdateAvatar = (data) => {\n    setIsLoading(true);\n    api\n      .patchNewAvatar(data)\n      .then((newUser) => {\n        setCurrentUser(newUser);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.error(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      });\n  };\n\n\n  const handleAddPlaceSubmit = ({ name, link }) => {\n    setIsLoading(true);\n    api.postNewCard(name, link)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.error(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      });\n  };\n\n\n\n  function swapHeaderLinks(name, route) {\n    setLinkName(name);\n    setLinkRoute(route);\n  }\n\n  function handleSetUserEmail(email) {\n    setUserEmail(email);\n  }\n\n  /** Проверяет наличие токена */\n  function checkToken() {\n    if (localStorage.getItem(\"jwt\")) {\n      const jwt = localStorage.getItem(\"jwt\");\n      auth\n        .checkToken(jwt)\n        .then((data) => {\n          setLoggedIn(true);\n          handleSetUserEmail(data.data.email);\n          navigate(\"/\");\n        })\n        .catch((err) => {\n          console.error(err);\n        });\n    }\n  }\n\n  React.useEffect(() => {\n    checkToken();\n  }, []);\n\n  function handleSignOutClick() {\n    navigate(\"/sign-in\");\n    localStorage.removeItem(\"jwt\");\n    setLoggedIn(false);\n  }\n\n  function handleRegistration(isSuccsses) {\n    setIsRegistrationSuccsses(isSuccsses);\n    setIsRegistationResultPopupOpen(true);\n  }\n\n  /** регистрация пользователя */\n  function handleUserRegister(password, email) {\n    auth\n      .register(password, email)\n      .then((data) => {\n        navigate(\"/sign-in\");\n        handleRegistration(true);\n      })\n      .catch((err) => {\n        console.error(err);\n        handleRegistration(false);\n      });\n  }\n\n  /** авторизация пользователя */\n  function handleUserAuthorization(password, email) {\n    auth\n      .authorization(password, email)\n      .then((data) => {\n        setLoggedIn(true);\n        setUserEmail(email);\n        navigate(\"/\");\n        localStorage.setItem(\"jwt\", data.token);\n      })\n      .catch((err) => {\n        console.error(err);\n      });\n  }\n\n  React.useEffect(() => {\n   if(loggedIn) {\n    api\n      .getInitialCards()\n      .then((cardsList) => {\n        setCards(cardsList);\n      })\n      .catch((err) => {\n        console.error(err);\n      });\n    }\n  }, [loggedIn]);\n\n  React.useEffect(() => {\n     if(loggedIn) {\n    api\n      .getUserInfo()\n      .then((data) => {\n        setCurrentUser(data);\n      })\n      .catch((err) => {\n        console.error(err);\n      });\n   }\n  }, [loggedIn]);\n\n  return (\n    <div className=\"page\">\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header\n          linkName={linkName}\n          linkRoute={linkRoute}\n          signOut={handleSignOutClick}\n          isLoggedIn={loggedIn}\n          userEmail={userEmail}\n        />\n        <Routes>\n          <Route\n            path=\"/sign-up\"\n            element={<Register onPage={swapHeaderLinks} onSubmit={handleUserRegister} />}\n          />\n          <Route\n            path=\"/sign-in\"\n            element={\n              <Login\n                onPage={swapHeaderLinks}\n                onSubmit={handleUserAuthorization}\n                setUserEmail={setUserEmail}\n              />\n            }\n          />\n          <Route\n            path=\"/\"\n            element={\n              <ProtectedRoute\n                loggedIn={loggedIn}\n                component={Main}\n                onEditProfile={handleEditProfileClick}\n                onAddPlace={handleAddPlaceClick}\n                onEditAvatar={handleEditAvatarClick}\n                onCardClick={handleCardClick} \n                cards={cards}\n                onCardLike={handleCardLike}\n                onCardDelete={handleDeleteClick}\n                onPage={swapHeaderLinks}\n                isLoading={isLoading}\n              />\n            }\n          />\n        </Routes>\n        <Footer />\n\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onUpdateUser={handleUpdateUser}\n          onClose={closeAllPopups}\n          isLoading={isLoading}\n        />\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onAddPlace={handleAddPlaceSubmit}\n          onClose={closeAllPopups}\n          isLoading={isLoading}\n        />\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n          isLoading={isLoading}\n        />\n   \n        <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n\n        <InfoToolTip\n          isOpen={isRegistationResultPopupOpen}\n          name=\"info-tool-tip\"\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleRegistration}\n          isRegistrationSuccsses={isRegistrationSuccsses}\n        />\n      </CurrentUserContext.Provider>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}